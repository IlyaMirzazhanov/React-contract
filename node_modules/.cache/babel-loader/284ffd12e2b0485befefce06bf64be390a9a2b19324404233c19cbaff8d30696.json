{"ast":null,"code":"var _jsxFileName = \"/home/ilya/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/Blockchain/contract-ui/src/Wallet.js\",\n  _s = $RefreshSig$();\nimport { React, useState, useEffect } from 'react';\nimport { ethers } from 'ethers';\nimport styles from './Wallet.module.css';\nimport simple_token_abi from './Contracts/simple_token_abi.json';\nimport Interactions from './Interactions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Wallet = () => {\n  _s();\n  // deploy simple token contract and paste deployed contract address here. This value is local ganache chain\n  let contractAddress = '0xd9145CCE52D386f254917e481eB44e9943F39138';\n  const ethers = require(\"ethers\");\n  const [errorMessage, setErrorMessage] = useState(null);\n  const [defaultAccount, setDefaultAccount] = useState(null);\n  const [connButtonText, setConnButtonText] = useState('Connect Wallet');\n  const [provider, setProvider] = useState(null);\n  const [signer, setSigner] = useState(null);\n  const [contract, setContract] = useState(null);\n  const [tokenName, setTokenName] = useState(\"Token\");\n  const [balance, setBalance] = useState(null);\n  const [transferHash, setTransferHash] = useState(null);\n  const connectWalletHandler = () => {\n    if (window.ethereum && window.ethereum.isMetaMask) {\n      window.ethereum.request({\n        method: 'eth_requestAccounts'\n      }).then(result => {\n        accountChangedHandler(result[0]);\n        setConnButtonText('Wallet Connected');\n      }).catch(error => {\n        setErrorMessage(error.message);\n      });\n    } else {\n      console.log('Need to install MetaMask');\n      setErrorMessage('Please install MetaMask browser extension to interact');\n    }\n  };\n\n  // update account, will cause component re-render\n  const accountChangedHandler = newAccount => {\n    setDefaultAccount(newAccount);\n    updateEthers();\n  };\n  const updateBalance = async () => {\n    let balanceBigN = await contract.balanceOf(defaultAccount);\n    let balanceNumber = balanceBigN.toNumber();\n    let tokenDecimals = await contract.decimals();\n    let tokenBalance = balanceNumber / Math.pow(10, tokenDecimals);\n    setBalance(toFixed(tokenBalance));\n  };\n  function toFixed(x) {\n    if (Math.abs(x) < 1.0) {\n      var e = parseInt(x.toString().split('e-')[1]);\n      if (e) {\n        x *= Math.pow(10, e - 1);\n        x = '0.' + new Array(e).join('0') + x.toString().substring(2);\n      }\n    } else {\n      var e = parseInt(x.toString().split('+')[1]);\n      if (e > 20) {\n        e -= 20;\n        x /= Math.pow(10, e);\n        x += new Array(e + 1).join('0');\n      }\n    }\n    return x;\n  }\n  const chainChangedHandler = () => {\n    // reload the page to avoid any errors with chain change mid use of application\n    window.location.reload();\n  };\n\n  // listen for account changes\n  window.ethereum.on('accountsChanged', accountChangedHandler);\n  window.ethereum.on('chainChanged', chainChangedHandler);\n  const updateEthers = () => {\n    let tempProvider = new ethers.providers.Web3Provider(window.ethereum);\n    setProvider(tempProvider);\n    let tempSigner = tempProvider.getSigner();\n    setSigner(tempSigner);\n    let tempContract = new ethers.Contract(contractAddress, simple_token_abi, tempSigner);\n    setContract(tempContract);\n  };\n  useEffect(() => {\n    if (contract != null) {\n      updateBalance();\n      updateTokenName();\n    }\n  }, [contract]);\n  const updateTokenName = async () => {\n    setTokenName(await contract.name());\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\" \", tokenName + \" ERC-20 Wallet\", \" \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles.button6,\n      onClick: connectWalletHandler,\n      children: connButtonText\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.walletCard,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [\"Address: \", defaultAccount]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [tokenName, \" Balance: \", balance]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 4\n      }, this), errorMessage]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Interactions, {\n      contract: contract\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 3\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 2\n  }, this);\n};\n_s(Wallet, \"KaEarA2+EIN1fJl3C4QcPJGPzWk=\");\n_c = Wallet;\nexport default Wallet;\nvar _c;\n$RefreshReg$(_c, \"Wallet\");","map":{"version":3,"names":["React","useState","useEffect","ethers","styles","simple_token_abi","Interactions","jsxDEV","_jsxDEV","Wallet","_s","contractAddress","require","errorMessage","setErrorMessage","defaultAccount","setDefaultAccount","connButtonText","setConnButtonText","provider","setProvider","signer","setSigner","contract","setContract","tokenName","setTokenName","balance","setBalance","transferHash","setTransferHash","connectWalletHandler","window","ethereum","isMetaMask","request","method","then","result","accountChangedHandler","catch","error","message","console","log","newAccount","updateEthers","updateBalance","balanceBigN","balanceOf","balanceNumber","toNumber","tokenDecimals","decimals","tokenBalance","Math","pow","toFixed","x","abs","e","parseInt","toString","split","Array","join","substring","chainChangedHandler","location","reload","on","tempProvider","providers","Web3Provider","tempSigner","getSigner","tempContract","Contract","updateTokenName","name","children","fileName","_jsxFileName","lineNumber","columnNumber","className","button6","onClick","walletCard","_c","$RefreshReg$"],"sources":["/home/ilya/Документы/Blockchain/contract-ui/src/Wallet.js"],"sourcesContent":["import {React, useState, useEffect} from 'react'\nimport {ethers} from 'ethers'\nimport styles from './Wallet.module.css'\nimport simple_token_abi from './Contracts/simple_token_abi.json'\nimport Interactions from './Interactions';\n\nconst Wallet = () => {\n\n\t// deploy simple token contract and paste deployed contract address here. This value is local ganache chain\n\tlet contractAddress = '0xd9145CCE52D386f254917e481eB44e9943F39138';\n\tconst ethers = require(\"ethers\")\n\n\tconst [errorMessage, setErrorMessage] = useState(null);\n\tconst [defaultAccount, setDefaultAccount] = useState(null);\n\tconst [connButtonText, setConnButtonText] = useState('Connect Wallet');\n\n\tconst [provider, setProvider] = useState(null);\n\tconst [signer, setSigner] = useState(null);\n\tconst [contract, setContract] = useState(null);\n\n\tconst [tokenName, setTokenName] = useState(\"Token\");\n\tconst [balance, setBalance] = useState(null);\n\tconst [transferHash, setTransferHash] = useState(null);\n\n\n\n\tconst connectWalletHandler = () => {\n\t\tif (window.ethereum && window.ethereum.isMetaMask) {\n\n\t\t\twindow.ethereum.request({ method: 'eth_requestAccounts'})\n\t\t\t.then(result => {\n\t\t\t\taccountChangedHandler(result[0]);\n\t\t\t\tsetConnButtonText('Wallet Connected');\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tsetErrorMessage(error.message);\n\t\t\t\n\t\t\t});\n\n\t\t} else {\n\t\t\tconsole.log('Need to install MetaMask');\n\t\t\tsetErrorMessage('Please install MetaMask browser extension to interact');\n\t\t}\n\t}\n\n\t// update account, will cause component re-render\n\tconst accountChangedHandler = (newAccount) => {\n\t\tsetDefaultAccount(newAccount);\n\t\tupdateEthers();\n\t}\n\n\tconst updateBalance = async () => {\n\t\tlet balanceBigN = await contract.balanceOf(defaultAccount);\n\t\tlet balanceNumber = balanceBigN.toNumber();\n\n\t\tlet tokenDecimals = await contract.decimals();\n\n\t\tlet tokenBalance = balanceNumber / Math.pow(10, tokenDecimals);\n\n\t\tsetBalance(toFixed(tokenBalance));\t\n\n\n\t}\n\n   function toFixed(x) {\n   if (Math.abs(x) < 1.0) {\n      var e = parseInt(x.toString().split('e-')[1]);\n      if (e) {\n         x *= Math.pow(10, e - 1);\n         x = '0.' + (new Array(e)).join('0') + x.toString().substring(2);\n      }\n   } else {\n      var e = parseInt(x.toString().split('+')[1]);\n      if (e > 20) {\n         e -= 20;\n         x /= Math.pow(10, e);\n         x += (new Array(e + 1)).join('0');\n      }\n   }\n   return x;\n}\n\n\tconst chainChangedHandler = () => {\n\t\t// reload the page to avoid any errors with chain change mid use of application\n\t\twindow.location.reload();\n\t}\n\n\t// listen for account changes\n\twindow.ethereum.on('accountsChanged', accountChangedHandler);\n\n\twindow.ethereum.on('chainChanged', chainChangedHandler);\n\n\tconst updateEthers = () => {\n\t\tlet tempProvider = new ethers.providers.Web3Provider(window.ethereum);\n\t\tsetProvider(tempProvider);\n\n\t\tlet tempSigner = tempProvider.getSigner();\n\t\tsetSigner(tempSigner);\n\n\t\tlet tempContract = new ethers.Contract(contractAddress, simple_token_abi, tempSigner);\n\t\tsetContract(tempContract);\t\n\t}\n\n\tuseEffect(() => {\n\t\tif (contract != null) {\n\t\t\tupdateBalance();\n\t\t\tupdateTokenName();\n\t\t}\n\t}, [contract]);\n\n\tconst updateTokenName = async () => {\n\t\tsetTokenName(await contract.name());\n\t}\n\t\n\treturn (\n\t<div>\n\t\t\t<h2> {tokenName + \" ERC-20 Wallet\"} </h2>\n\t\t\t<button className={styles.button6} onClick={connectWalletHandler}>{connButtonText}</button>\n\n\t\t\t<div className={styles.walletCard}>\n\t\t\t<div>\n\t\t\t\t<h3>Address: {defaultAccount}</h3>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<h3>{tokenName} Balance: {balance}</h3>\n\t\t\t</div>\n\n\t\t\t{errorMessage}\n\t\t</div>\n\t\t<Interactions contract = {contract}/>\n\t</div>\n\t)\n}\n\nexport default Wallet;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}